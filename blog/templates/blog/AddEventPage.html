{% extends 'blog/base/base.html' %}
{% load static %}

{% block content %}
<style>
    .date-input-container {
        position: relative;
    }
    
    .date-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #666;
        pointer-events: none;
    }
    
    input[type="date"] {
        appearance: none;
        padding-right: 2.5rem;
    }
    
    input[type="date"]::-webkit-calendar-picker-indicator {
        opacity: 0;
        position: absolute;
        right: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    /* Enhanced styles */
    .form-container {
        max-width: 700px;
        margin: 2rem auto;
        padding: 2rem;
        background-color: white;
        border-radius: 1rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        animation: fadeIn 0.6s ease-out;
    }

    .event-form{
        max-width: 600px;
    }

    .form-title {
        font-size: 2rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 1.5rem;
        text-align: center;
        position: relative;
        padding-bottom: 0.75rem;
    }

    .form-title:after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 4px;
        background-color: #ffd502;
        border-radius: 2px;
    }

    .form-field {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #4a5568;
    }

    .event-form input[type="text"],
    .event-form input[type="date"],
    .event-form textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .event-form input[type="text"]:focus,
    .event-form input[type="date"]:focus,
    .event-form textarea:focus {
        border-color: #ffd502;
        box-shadow: 0 0 0 3px rgba(255, 213, 2, 0.2);
        outline: none;
    }

    .form-buttons {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 2rem;
    }

    .btn {
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        background-color: #ffd502;
        color: #333;
        border: 2px solid #ffd502;
    }

    .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(255, 213, 2, 0.4);
    }

    .btn:active {
        transform: translateY(-1px);
    }

    /* File upload styling */
    .file-upload-container {
        margin-top: 2rem;
        margin-bottom: 2rem;
    }

    .custom-file-upload {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        border: 2px dashed #cbd5e0;
        border-radius: 0.75rem;
        cursor: pointer;
        transition: all 0.3s ease;
        background-color: #f7fafc;
    }

    .custom-file-upload:hover {
        border-color: #ffd502;
        background-color: rgba(255, 213, 2, 0.05);
    }

    .upload-icon {
        margin-bottom: 1rem;
        transition: transform 0.3s ease;
    }

    .custom-file-upload:hover .upload-icon {
        transform: translateY(-5px);
    }

    .upload-text {
        color: #ffd502;
        font-weight: 600;
    }

    .error {
        color: #e53e3e;
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }

    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .pulse-animation {
        animation: pulse 2s infinite;
    }
</style>

<div class="form-container">
    <form method="POST" enctype="multipart/form-data" class="event-form">
        {% csrf_token %}
        
        <h1 class="form-title">
            Add New Event
        </h1>
        
        <!-- Django Form Fields -->
        <div class="form-field">
            <label for="{{ form.title.id_for_label }}" class="form-label">
                Title
            </label>
            {{ form.title }}
        </div>

        <div class="form-field">
            <label for="{{ form.location.id_for_label }}" class="form-label">
                Location
            </label>
            {{ form.location }}
        </div>

        <div class="form-field">
            <label for="{{ form.event_date.id_for_label }}" class="form-label"> 
                Start Date
            </label>
            <div class="date-input-container">
                {{ form.event_date }}
                <i class="fas fa-calendar-alt date-icon"></i>
            </div>
            {% if form.event_date.errors %}
                <div class="error">{{ form.event_date.errors }}</div>
            {% endif %}
        </div>
        
        <div class="form-field">
            <label for="{{ form.event_end_date.id_for_label }}" class="form-label">
                End Date
            </label>
            <div class="date-input-container">
                {{ form.event_end_date }}
                <i class="fas fa-calendar-alt date-icon"></i>
            </div>
            {% if form.event_end_date.errors %}
                <div class="error">{{ form.event_end_date.errors }}</div>
            {% endif %}
            {% if form.non_field_errors %}
                <div class="error">{{ form.non_field_errors }}</div>
            {% endif %}
        </div>

        <div class="form-field">
            <label for="{{ form.content.id_for_label }}" class="form-label">
                Description
            </label>
            {{ form.content }}
        </div>

        <!-- Custom File Upload Field -->
        <div class="file-upload-container">
            <input class="input-image" name="image" id="file" type="file" accept="image/*" hidden />
            
            <label for="file" class="custom-file-upload" id="upload-label">
                <div class="upload-icon">
                    <svg xml:space="preserve" viewBox="0 0 184.69 184.69" xmlns:xlink="http://www.w3.org/1999/xlink"
                         xmlns="http://www.w3.org/2000/svg" id="Capa_1" version="1.1" width="60px" height="60px">
                        <g>
                            <g>
                                <path d="M149.968,50.186c-8.017-14.308-23.796-22.515-40.717-19.813
                              C102.609,16.43,88.713,7.576,73.087,7.576c-22.117,0-40.112,17.994-40.112,40.115c0,0.913,0.036,1.854,0.118,2.834
                              C14.004,54.875,0,72.11,0,91.959c0,23.456,19.082,42.535,42.538,42.535h33.623v-7.025H42.538
                              c-19.583,0-35.509-15.929-35.509-35.509c0-17.526,13.084-32.621,30.442-35.105c0.931-0.132,1.768-0.633,2.326-1.392
                              c0.555-0.755,0.795-1.704,0.644-2.63c-0.297-1.904-0.447-3.582-0.447-5.139c0-18.249,14.852-33.094,33.094-33.094
                              c13.703,0,25.789,8.26,30.803,21.04c0.63,1.621,2.351,2.534,4.058,2.14c15.425-3.568,29.919,3.883,36.604,17.168
                              c0.508,1.027,1.503,1.736,2.641,1.897c17.368,2.473,30.481,17.569,30.481,35.112c0,19.58-15.937,35.509-35.52,35.509H97.391
                              v7.025h44.761c23.459,0,42.538-19.079,42.538-42.535C184.69,71.545,169.884,53.901,149.968,50.186z"
                                      style="fill: #ffd502"></path>
                                <path d="M108.586,90.201c1.406-1.403,1.406-3.672,0-5.075L88.541,65.078
                              c-0.701-0.698-1.614-1.045-2.534-1.045l-0.064,0.011c-0.018,0-0.036-0.011-0.054-0.011c-0.931,0-1.85,0.361-2.534,1.045
                              L63.31,85.127c-1.403,1.403-1.403,3.672,0,5.075c1.403,1.406,3.672,1.406,5.075,0L82.296,76.29v97.227
                              c0,1.99,1.603,3.597,3.593,3.597c1.979,0,3.59-1.607,3.59-3.597V76.165l14.033,14.036
                              C104.91,91.608,107.183,91.608,108.586,90.201z"
                                      style="fill: #ffd502"></path>
                            </g>
                        </g>
                    </svg>
                </div>
                <p>Drag & drop your file here or <span class="upload-text">click to upload</span></p>
                <div id="file-name-display" class="mt-2 text-sm text-gray-600 hidden"></div>
            </label>
        </div>

        <!-- Submit & Discard Buttons -->
        <div class="form-buttons">
            <button type="submit" class="btn" id="save-btn">
                Save Event
            </button>
            <a href="{% url 'announcement' %}" class="btn" style="background-color: white; color: #333;">
                Discard
            </a>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Date validation
        const startDateInput = document.getElementById('{{ form.event_date.id_for_label }}');
        const endDateInput = document.getElementById('{{ form.event_end_date.id_for_label }}');
    
        startDateInput.addEventListener('change', function() {
            if (this.value && endDateInput.value) {
                if (new Date(this.value) > new Date(endDateInput.value)) {
                    endDateInput.value = this.value;
                }
            }
            endDateInput.min = this.value;
        });
    
        endDateInput.addEventListener('change', function() {
            if (startDateInput.value && this.value) {
                if (new Date(this.value) < new Date(startDateInput.value)) {
                    alert('End date must be after start date');
                    this.value = startDateInput.value;
                }
            }
        });

        // File upload enhancements
        const fileInput = document.getElementById('file');
        const uploadLabel = document.getElementById('upload-label');
        const fileNameDisplay = document.getElementById('file-name-display');
        const saveBtn = document.getElementById('save-btn');
        
        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const fileName = this.files[0].name;
                fileNameDisplay.textContent = 'Selected file: ' + fileName;
                fileNameDisplay.classList.remove('hidden');
                
                // Add success styling to upload area
                uploadLabel.style.borderColor = '#48bb78';
                uploadLabel.style.backgroundColor = 'rgba(72, 187, 120, 0.1)';
                
                // Add pulse animation to save button
                saveBtn.classList.add('pulse-animation');
                setTimeout(() => {
                    saveBtn.classList.remove('pulse-animation');
                }, 2000);
            }
        });
        
        // Drag and drop functionality
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadLabel.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadLabel.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            uploadLabel.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            uploadLabel.style.borderColor = '#ffd502';
            uploadLabel.style.backgroundColor = 'rgba(255, 213, 2, 0.1)';
        }
        
        function unhighlight() {
            uploadLabel.style.borderColor = '#cbd5e0';
            uploadLabel.style.backgroundColor = '#f7fafc';
        }
        
        uploadLabel.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files && files.length) {
                fileInput.files = files;
                const fileName = files[0].name;
                fileNameDisplay.textContent = 'Selected file: ' + fileName;
                fileNameDisplay.classList.remove('hidden');
                
                // Add success styling
                uploadLabel.style.borderColor = '#48bb78';
                uploadLabel.style.backgroundColor = 'rgba(72, 187, 120, 0.1)';
                
                // Add pulse animation to save button
                saveBtn.classList.add('pulse-animation');
                setTimeout(() => {
                    saveBtn.classList.remove('pulse-animation');
                }, 2000);
            }
        }
        
        // Form field animations
        const formFields = document.querySelectorAll('.form-field');
        formFields.forEach((field, index) => {
            field.style.opacity = '0';
            field.style.transform = 'translateY(20px)';
            field.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            
            setTimeout(() => {
                field.style.opacity = '1';
                field.style.transform = 'translateY(0)';
            }, 100 * (index + 1));
        });
    });
</script>
{% endblock %}